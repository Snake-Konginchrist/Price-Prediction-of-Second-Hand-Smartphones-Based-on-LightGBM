# 二手手机价格预测系统 - 数据预处理技术文档

## 概述

本文档详细介绍了二手手机价格预测系统中采用的数据预处理方法和技术流程。系统通过多步骤的数据清洗、特征编码、异常值处理等技术，将原始二手手机数据转换为适合机器学习算法训练的标准化数据格式。

## 数据集介绍

### 使用的数据文件

本项目共使用了以下数据文件：

#### 1. 原始数据文件

- **`data/raw_phone_prices.xlsx`**: 原始二手手机价格数据，包含405条记录
- **数据来源**: 同城帮二手手机交易平台
- **数据格式**: Excel格式，包含9个主要特征字段

#### 2. 预处理后的数据文件

- **`data/processed_phone_prices_zh.xlsx`**: 中文版预处理数据，用于模型训练
- **`data/processed_phone_prices_en.xlsx`**: 英文版预处理数据，便于国际化使用
- **`data/used_phone_encoding.xlsx`**: 编码映射表，记录特征编码关系
- **`data/feature_mapping_table.xlsx`**: 特征映射关系表，用于预测时的反向转换

#### 3. 模型和结果文件

- **`model/LightGBM_phone_price-predict.pkl`**: 训练好的LightGBM模型
- **`data/price_prediction_percent_error.txt`**: 价格预测误差分析结果
- **`LightGBM Accuracy Change Curve.png`**: 模型训练准确率变化曲线图

### 数据字段结构

原始数据包含以下9个主要特征字段：

- **品牌**: 手机品牌名称（如：苹果、华为、小米等）
- **型号**: 具体手机型号（如：iPhone 13、Mate 40等）
- **颜色**: 手机颜色（如：黑色、白色、蓝色等）
- **网络**: 网络制式（如：4G、5G等）
- **成色**: 手机新旧程度（如：全新、9成新、8成新等）
- **内存（GB）**: 运行内存大小
- **存储（GB）**: 存储空间大小
- **原价（元）**: 手机原始售价
- **现价（元）**: 二手手机当前售价（目标变量）

## 数据预处理流程

### 1. 原始数据加载与结构分析

#### 1.1 数据源

- **原始数据文件**: `data/raw_phone_prices.xlsx`
- **数据格式**: Excel格式，包含二手手机的多维度特征信息
- **数据规模**: 405条记录，包含品牌、型号、颜色、网络、成色、内存、存储、原价、现价等字段

#### 1.2 数据字段结构

原始数据包含以下9个主要特征字段：

- **品牌**: 手机品牌名称（如：苹果、华为、小米等）
- **型号**: 具体手机型号（如：iPhone 13、Mate 40等）
- **颜色**: 手机颜色（如：黑色、白色、蓝色等）
- **网络**: 网络制式（如：4G、5G等）
- **成色**: 手机新旧程度（如：全新、9成新、8成新等）
- **内存（GB）**: 运行内存大小
- **存储（GB）**: 存储空间大小
- **原价（元）**: 手机原始售价
- **现价（元）**: 二手手机当前售价（目标变量）

### 2. 特征编码处理

#### 2.1 标签编码（Label Encoding）

**适用特征**: 品牌、型号、颜色
**技术原理**: 将分类变量转换为数值编码，保持类别间的顺序关系

**编码优势**:

- 保持类别间的相对关系
- 减少特征维度
- 适合树模型算法（如LightGBM、XGBoost）

**编码映射保存**: 将编码-标签映射关系保存到 `data/feature_mapping_table.xlsx`，便于预测时的反向转换

#### 2.2 独热编码（One-Hot Encoding）

**适用特征**: 网络、成色
**技术原理**: 将分类变量转换为二进制向量，消除类别间的顺序关系

**编码优势**:

- 消除类别间的虚假顺序关系
- 适合线性模型（如SVM）
- 避免模型对编码值大小产生误解

**特征扩展**: 独热编码会将单个特征扩展为多个二进制特征，增加特征维度

### 3. 数据清洗与质量保证

#### 3.1 异常值处理

**技术方法**: 基于IQR（四分位距）的异常值检测与处理

**处理策略**:

- 对数值型特征（内存、存储、价格）进行异常值检测
- 使用1.5倍IQR作为异常值判定标准
- 采用截断（clipping）而非删除的方式处理异常值，保持数据完整性

#### 3.2 数据完整性检查

**缺失值处理**: 项目数据质量较好，未发现明显的缺失值问题
**数据类型转换**: 确保数值型特征的数据类型正确
**数据范围验证**: 验证价格、内存、存储等数值特征的合理性

### 4. 特征工程与选择

#### 4.1 特征组合策略

**保留特征**:

- 品牌编码: 反映品牌价值差异
- 型号编码: 体现具体型号的市场定位
- 颜色编码: 影响二手手机的市场接受度
- 网络独热编码: 反映网络制式对价格的影响
- 成色独热编码: 体现手机新旧程度对价格的影响
- 内存（GB）: 直接影响手机性能和使用体验
- 存储（GB）: 影响手机存储容量和实用性
- 原价（元）: 反映手机原始价值，是重要的价格参考

**特征重要性分析**: 通过模型训练过程中的特征重要性评估，验证特征选择的合理性

#### 4.2 特征标准化

**SVM模型**: 使用StandardScaler进行特征标准化

**标准化目的**:

- 消除特征间的量纲差异
- 提高SVM等对特征尺度敏感算法的性能
- 确保不同特征对模型训练的贡献度均衡

**树模型**: LightGBM和XGBoost对特征尺度不敏感，无需标准化

### 5. 数据集划分策略

#### 5.1 训练测试集划分

采用标准的80%训练集、20%测试集划分比例，使用固定随机种子确保结果可复现。

**划分原则**:

- 保持数据分布的随机性
- 确保训练集和测试集的代表性
- 使用固定随机种子保证结果可复现

#### 5.2 验证集划分（LightGBM）

从训练集中进一步划分20%作为验证集，用于早停机制和过拟合监控。

**验证集用途**:

- 早停机制（Early Stopping）的监控
- 防止模型过拟合
- 优化模型训练过程

### 6. 数据预处理结果

#### 6.1 处理后的数据文件

- **`data/processed_phone_prices_zh.xlsx`**: 中文版预处理数据
- **`data/processed_phone_prices_en.xlsx`**: 英文版预处理数据
- **`data/used_phone_encoding.xlsx`**: 编码映射表
- **`data/feature_mapping_table.xlsx`**: 特征映射关系表

#### 6.2 数据质量指标

**数据完整性**: 100%（无缺失值）
**异常值处理**: 基于IQR方法，确保数据分布合理
**特征维度**: 原始9个特征 → 预处理后约15-20个特征（考虑独热编码扩展）
**数据规模**: 405条记录，适合机器学习模型训练

### 7. 预处理技术优势

#### 7.1 技术选型优势

1. **混合编码策略**: 根据特征特性选择合适的编码方式
   - 标签编码：适合有序分类特征
   - 独热编码：适合无序分类特征

2. **异常值处理**: 采用截断而非删除，保持数据完整性

3. **特征保留策略**: 保留所有原始信息，避免信息丢失

#### 7.2 模型适配性

1. **LightGBM/XGBoost**: 直接使用预处理后的数据，无需额外标准化
2. **SVM**: 配合StandardScaler标准化，提高模型性能
3. **通用性**: 预处理流程适用于多种机器学习算法

### 8. 预测时的数据预处理

#### 8.1 新数据预处理流程

新数据预处理包括四个主要步骤：加载编码映射关系、进行编码转换、应用异常值处理、使用训练好的模型进行预测。

#### 8.2 一致性保证

- 使用相同的编码映射关系
- 应用相同的异常值处理逻辑
- 保持特征顺序和维度一致

### 9. 数据预处理最佳实践

#### 9.1 代码组织

- **模块化设计**: 将预处理逻辑封装为独立函数
- **可复用性**: 预处理函数支持训练和预测场景
- **可维护性**: 清晰的代码结构和注释

#### 9.2 数据版本管理

- **原始数据备份**: 保留原始数据文件
- **预处理结果保存**: 保存中间处理结果
- **映射关系记录**: 详细记录编码映射关系

#### 9.3 性能优化

- **批量处理**: 一次性处理整个数据集
- **内存管理**: 使用copy()避免SettingWithCopyWarning
- **计算效率**: 合理使用向量化操作

## 总结

本系统的数据预处理方案具有以下特点：

1. **技术全面**: 涵盖编码、清洗、标准化等关键预处理步骤
2. **策略合理**: 根据特征特性和算法需求选择合适的预处理方法
3. **流程规范**: 标准化的预处理流程，确保结果可复现
4. **实用性强**: 预处理结果直接支持多种机器学习算法
5. **扩展性好**: 预处理流程易于扩展到新的数据和模型

通过这套完整的数据预处理方案，系统成功将原始二手手机数据转换为高质量的机器学习训练数据，为后续的模型训练和价格预测奠定了坚实的基础。
